<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Ticket #{{ ticket.id }} - {{ ticket.titulo }}</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f8f9fa;
        }
        .ticket-container {
            max-width: 800px;
            margin: 2rem auto;
            background-color: #fff;
            border: 1px solid #dee2e6;
            border-radius: 0.5rem;
            padding: 2rem;
            box-shadow: 0 0.5rem 1rem rgba(0,0,0,.15);
        }
        .ticket-header {
            text-align: center;
            border-bottom: 2px solid #dee2e6;
            padding-bottom: 1.5rem;
            margin-bottom: 1.5rem;
        }
        .ticket-section h4 {
            border-bottom: 1px solid #eee;
            padding-bottom: 0.5rem;
            margin-bottom: 1rem;
            color: #495057;
        }
        .comment-item {
            border-top: 1px dashed #ccc;
            padding-top: 1rem;
            margin-top: 1rem;
        }
        @media print {
            body {
                background-color: #fff;
            }
            .ticket-container {
                box-shadow: none;
                border: none;
                margin: 0;
                max-width: 100%;
            }
            .no-print {
                display: none;
            }
        }
    </style>
</head>
<body>

    <div class="ticket-container">
        <div class="ticket-header">
            <h1 class="display-5 fw-bold">COYAHUE GROUP</h1>
            <p class="lead">Reporte de Ticket de Soporte</p>
            <h2 class="mt-3">Ticket #{{ ticket.id }}</h2>
        </div>

        <div class="ticket-section mb-4">
            <h4><i class="fas fa-info-circle me-2 text-primary"></i>Detalles Principales</h4>
            <div class="row">
                <div class="col-md-6">
                    <p><strong>Título:</strong> {{ ticket.titulo }}</p>
                    <p><strong>Solicitante:</strong> {{ ticket.solicitante.username }}</p>
                    <p><strong>Técnico Asignado:</strong> {{ ticket.tecnico_asignado.username|default:"No asignado" }}</p>
                    <p><strong>Área Solicitante:</strong> {{ ticket.area_funcional.nombre }}</p>
                </div>
                <div class="col-md-6">
                    <p><strong>Estado:</strong> {{ ticket.get_estado_display }}</p>
                    <p><strong>Prioridad:</strong> {{ ticket.prioridad.nombre }} ({{ ticket.prioridad.minutos_resolucion }} min)</p>
                    <p><strong>Categoría:</strong> {{ ticket.get_categoria_display }}</p>
                    <p><strong>Tipo:</strong> {{ ticket.get_tipo_ticket_display }}</p>
                </div>
            </div>
        </div>

        <div class="ticket-section mb-4">
            <h4><i class="fas fa-file-alt me-2 text-primary"></i>Descripción Completa</h4>
            <p>{{ ticket.descripcion|linebreaksbr }}</p>
        </div>

        <div class="ticket-section mb-4">
            <h4><i class="fas fa-history me-2 text-primary"></i>Historial de Actividad</h4>
            {% for comment in comments %}
                <div class="comment-item">
                    <p class="mb-1">
                        <strong>{{ comment.author.username }}</strong> 
                        <span class="text-muted small"> ({{ comment.created_at|date:"d M Y, H:i" }})</span>
                    </p>
                    <p class="mb-0">{{ comment.text|linebreaksbr }}</p>
                </div>
            {% empty %}
                <p class="text-muted">No hay comentarios en este ticket.</p>
            {% endfor %}
        </div>
        
        <hr class="my-4">
        
        <div class="row text-muted small">
            <div class="col">
                <strong>Fecha de Creación:</strong> {{ ticket.fecha_creacion|date:"d M Y, H:i" }}
            </div>
            {% if ticket.fecha_cierre %}
            <div class="col text-end">
                <strong>Fecha de Cierre:</strong> {{ ticket.fecha_cierre|date:"d M Y, H:i" }} | 
                <strong>Tiempo de Resolución:</strong> {{ ticket.tiempo_resolucion }}
            </div>
            {% endif %}
        </div>
    </div>

    <div class="text-center my-4 no-print">
        <button onclick="window.print()" class="btn btn-success btn-lg">
            <i class="fas fa-print me-2"></i> Imprimir / Guardar como PDF
        </button>
        <a href="{% url 'detalle_ticket' ticket.id %}" class="btn btn-secondary btn-lg">
            <i class="fas fa-arrow-left me-2"></i> Volver al Ticket
        </a>
    </div>

</body>
</html>